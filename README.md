# AnkleWankle

## Contributing

The following sections will guide you through [setting up a development environment](#dev-env), [developing](#dev), [compiling](#dev-compiling), [debugging](#dev-debug) and [committing your code changes](#dev-committing), and it will tell you [where to find documentation](#dev-doc).

### Setting up a development environment<a name="dev-env"></a>
1. Install the latest LTS version of Node.js (https://nodejs.org/en/download/)
2. Confirm installation of Node.js by running `node -v`
3. npm should have been included in Node.js, confirm by running `npm -v`
4. Clone this repository by running `git clone ssh://git@student.inso.tuwien.ac.at:1850/ehtp-2020s/gruppe2.git`
5. Changedir into the cloned directory by running `cd gruppe2`
6. Install TypeScript by running `npm install -g typescript` (This command needs root/administrator privileges, if it fails and you're on linux, prepend it with `sudo`, otherwise find out how to run commands with administrator privileges on your operating system and re-run accordingly. Alternatively, confirm `npx` was also installed by running `npx -v`, re-run the command without the `-g` flag in order to install typescript locally instead of globally, i.e. run `npm install typescript`, and prepend all following `tsc` commands with `npx`. For example, instead of `tsc --watch`, you would then run `npx tsc --watch`.)
7. Install dependencies by running `npm install`

### Developing<a name="dev"></a>

#### Entry points

The source code is in `src/ts`. Entry points:
- Server: `src/ts/server/server.ts`
- Client: `src/ts/client/client.ts`

#### Overview

`src/ts/server` contains source code for the server side, `src/ts/client` contains source code for the client side. `src/ts/common` contains source code that is used by both server and client.

The TypeScript source code in the `.ts` files is compiled to JavaScript by the TypeScript compiler (`tsc`) and output to `out/js/`. Every TypeScript file `src/ts/foo/bar/xyz.ts` is compiled to a corresponding JavaScript file `out/js/foo/bar/xyz.js`.
Additionally, the client source code files are packed into a single JavaScript file, which will be output to `out/static/js/client.js` by webpack. In order to do that, webpack starts by adding the client entry JavaScript file `out/js/client/client.js` and also adds all other files this file includes (and all other files those files include, and so on).

The server is essentially a webserver that serves its clients the `static/index.html` file and the client source code file `out/static/js/client.js` that was generated by webpack (using the many JavaScript files in `out/js/` that were previously compiled by the TypeScript compiler from the many TypeScript files in `src/ts/`).

The server source code runs in Node.js, the client source code runs in the user's web browser.

### Compiling<a name="dev-compiling"></a>

Compilation consists of one step for the server code and an additional step for the client code:
1. Compiling both server and client TypeScript source code to JavaScript using the TypeScript compiler
2. Combining all client JavaScript source code files into a single JavaScript file using webpack

Both steps can be done by running `npm run build` (assuming you changedir-ed into this repository beforehand).

Alternatively, in order to avoid having to run `npm run build` every time you change the source code, and in order to speed up the compilation process, you can run the following two commands in parallel (e.g. in two separate terminal windows) and leave them running while developing:
1. `npm run tsc-watch`
2. `npm run webpack-watch`

Both commands monitor their respective source files for changes and update their compiled output files accordingly. The source files for the TypeScript compiler (which is started with the first command) are all files in `src/ts/`, the source files for webpack (which is started with the second command) are all files directly or indirectly included by `out/js/client/client.js`, which in turn is an output file of the TypeScript compiler.
This means that, if you change a client TypeScript source file, its corresponding JavaScript file is first updated by the TypeScript compiler, and afterwards `out/static/js/client.js` is updated by webpack.

### Running

Start the server side by running `npm run server`<br>
Run the client side by pointing your web browser at http://localhost:8080/.

### Debugging<a name="dev-debug"></a>

The server can be debugged by running `npm run server-debug` (instead of `npm run server`) and then connecting a debugger to the Node.js process, for example using Visual Studio Code: Press `Ctrl + Shift + P` (or click `View` -> `Command Palette...`) to get the Command Palette, then type `Debug: Attach to Node process` and hit `Enter`. Select the process called something like `nodejs --inspect-brk out/js/server/server.js`, hit `Enter` again, and you should be good to go.

The client side can be debugged using your web browser's built-in developer tools: Point your browser to http://localhost:8080/ and, at least in Firefox and Chrome, press `F12` (Or select them via the main menu).

### Committing code changes<a name="dev-committing"></a>

Before you start working on a new feature, fix or other item, please create a new branch. To do that, follow these steps (again assuming you changedir-ed into this repository before):
1. Run `git status` to confirm you're currently on the `master` branch. The first line of the output should read `On branch master`. If not, run `git checkout master` and check again
2. Download the latest version of the source code by running `git pull`
3. Think of a cool name for your feature, then create a branch for it by running `git checkout -b feature/<cool-feature-name>` (e.g. `git checkout -b feature/blockchain-integration` or `git checkout -b feature/ai-opponents`)
4. Confirm you've switched to your new branch by running `git status` again. The first line should read `On branch feature/<cool-feature-name>`

Now, write your code, commit it and push your changes to the remote by running `git push`. When running that command for the first time, git will probably complain about this branch not having an upstream branch. Use the command it suggests as fix instead (i.e. `git push --set-upstream origin feature/<cool-feature-name>`).

When you've completed implementing your feature, fix or other item and your changes are all committed and pushed, head to GitLab to create a merge request. If GitLab doesn't already suggest so on the project overview page, select `Merge Requests` from the left menu to create one. Select your feature branch as source and the `master` branch as target branch.

In your merge requests, you'll have a nice overview of all the changes you're making to the source code. When you're confident everything is alright, accept the merge request in order to apply your changes to the `master` branch.

### Where to find documentation<a name="dev-doc"></a>

- Node.js: https://nodejs.org/
- NPM: https://www.npmjs.com/
- TypeScript: https://www.typescriptlang.org/
- Express: https://expressjs.com/
- Socket<span>.</span>IO: https://socket.io/
- Vue.js: https://vuejs.org/